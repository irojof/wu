<!DOCTYPE html>
<!--[if IE 9 ]><html class="ie9"><![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Western Union</title>

  <!-- Vendor CSS -->

  <link href="vendors/bootgrid/jquery.bootgrid.min.css" rel="stylesheet">

  <link href="vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
  <link href="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">
  <link href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
  <link href="vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.min.css" rel="stylesheet">
  <link href="vendors/bower_components/bootstrap-select/dist/css/bootstrap-select.css" rel="stylesheet">
  <link href="vendors/bower_components/nouislider/distribute/jquery.nouislider.min.css" rel="stylesheet">
  <link href="vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
  <link href="vendors/farbtastic/farbtastic.css" rel="stylesheet">
  <link href="vendors/bower_components/chosen/chosen.min.css" rel="stylesheet">
  <link href="vendors/summernote/dist/summernote.css" rel="stylesheet">

  <!-- CSS -->
  <link href="css/app.min.1.css" rel="stylesheet">
  <link href="css/app.min.2.css" rel="stylesheet">
  <link href="css/own.css" rel="stylesheet">
  <link href="css/caribedev.css" rel="stylesheet">
</head>

<body>
  <!--#include file="header.aspx"-->
  <section id="main">
    <section id="content">
      <div class="container">
        <div class="block-header">
          <h2>TRANSACTION VIEW</h2>
        </div>
        <!-- START CONTENT -->
        <button class="btn btn-float btn-info m-btn" id="btn_transaction_profile_create" name="btn_transaction_profile_create"><i class="zmdi zmdi-plus"></i></button>
        <div class="card bs-item z-depth-1">
          <div class="card-header ch-alt">
            <h2>Customer</h2>
          </div>
          <div class="card-body card-padding">
            <div class="row">
              <div class="col-md-12">
                <div class="row">
                  <div class=" col-md-6">
                    <div class="input-group ">
                      <span class="input-group-addon"><i class="zmdi zmdi-accounts-list"></i></span>
                      <div class="fg-line">
                        <input type="text" class="form-control input-lg" id="transaction_profile_uuid" name="transaction_profile_uuid" placeholder="UUID" disabled>
                      </div>
                    </div>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="zmdi zmdi-accounts-list"></i></span>
                      <div class="fg-line">
                        <input type="text" class="form-control date-picker input-lg" id="transaction_profile_idcard" name="transaction_profile_idcard" placeholder="ID Card" disabled>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="input-group ">
                      <span class="input-group-addon"><i class="zmdi zmdi-account-circle"></i></span>
                      <div class="fg-line">
                        <input type="text" class="form-control input-lg" id="transaction_profile_name" name="transaction_profile_name" placeholder="Name" disabled>
                      </div>
                    </div>
                    <div class="input-group ">
                      <span class="input-group-addon"><i class="zmdi zmdi-account-circle"></i></span>
                      <div class="fg-line">
                        <input type="text" class="form-control input-lg" id="transaction_profile_lastname" name="transaction_profile_lastname" placeholder="Last Name" disabled>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <br/>
          </div>
        </div>
        <div class="card bs-item z-depth-1">
          <div class="card-header ch-alt">
            <h2>TO SEND</h2>
          </div>
          <div class="card-body card-padding">
            <div class="row">
              <div class="col-md-12">
                <div class="input-group ">
                  <span class="input-group-addon"><i class="zmdi zmdi-format-indent-increase zmdi-hc-fw"></i></span>
                  <div class="fg-line">
                    <input type="text" class="form-control input-lg" id="transaction_profile_view_send_many" name="transaction_profile_view_send_many" placeholder="How many transactions are you expected to remit during a month:">
                  </div>
                </div>
              </div>
              <div class="col-md-12">
                <div class="input-group ">
                  <span class="input-group-addon"><i class="zmdi zmdi-money zmdi-hc-fw"></i></span>
                  <div class="fg-line">
                    <input type="text" class="form-control input-lg" id="transaction_profile_view_send_amount" name="transaction_profile_view_send_amount" placeholder="What is the maximun amount you expect to be remitting during a month:">
                  </div>
                </div>
              </div>
            </div>
            <div class="row-sm-12">
              <table id="tbl_profile_send" class="table table-striped table-vmiddle">
                <thead>
                  <tr>
                    <!-- <th data-column-id="transaction_profile_uuid">ID</th> -->
                    <th data-column-id="transaction_profile_name">FULL NAME</th>
                    <th data-column-id="transaction_profile_country">COUNTRY</th>
                    <th data-column-id="transaction_profile_relationship">RELATIONSHIP</th>
                    <th data-column-id="transaction_profile_reason">REASON</th>
                    <th data-column-id="commands" data-formatter="commands" data-sortable="false">ACTIONS</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </div> <!-- end card -->
        <div class="card bs-item z-depth-1">
          <div class="card-header ch-alt">
            <h2>TO RECEIVE</h2>
          </div>
          <div class="card-body card-padding">
            <div class="row">
              <div class="col-md-12">
                <div class="input-group ">
                  <span class="input-group-addon"><i class="zmdi zmdi-format-indent-increase zmdi-hc-fw"></i></span>
                  <div class="fg-line">
                    <input type="text" class="form-control input-lg" id="transaction_profile_view_receive_many" name="transaction_profile_view_receive_many" placeholder="How many transactions are you expected to remit during a month:">
                  </div>
                </div>
              </div>
              <div class="col-md-12">
                <div class="input-group ">
                  <span class="input-group-addon"><i class="zmdi zmdi-money zmdi-hc-fw"></i></span>
                  <div class="fg-line">
                    <input type="text" class="form-control input-lg" id="transaction_profile_view_receive_amount" name="transaction_profile_view_receive_amount" placeholder="What is the maximun amount you expect to be remitting during a month:">
                  </div>
                </div>
              </div>
            </div>
            <div class="row-sm-12">
              <table id="tbl_profile_receive" class="table table-striped table-vmiddle">
                <thead>
                  <tr>
                    <!-- <th data-column-id="transaction_profile_uuid">ID</th> -->
                    <th data-column-id="transaction_profile_name">FULL NAME</th>
                    <th data-column-id="transaction_profile_country">COUNTRY</th>
                    <th data-column-id="transaction_profile_relationship">RELATIONSHIP</th>
                    <th data-column-id="transaction_profile_reason">REASON</th>
                    <th data-column-id="commands" data-formatter="commands" data-sortable="false">ACTIONS</th>
                  </tr>
                </thead>
                <tbody>
                </tbody>
              </table>
            </div>
          </div>
        </div> <!-- end card -->
      </div>
    </section>
  </section>

  <footer id="footer">
    Copyright &copy; 2016 caribeDevelopers.com
  </footer>

  <!-- Page Loader -->
  <div class="page-loader">
    <div class="preloader pls-blue">
      <svg class="pl-circular" viewBox="25 25 50 50">
        <circle class="plc-path" cx="50" cy="50" r="20" />
      </svg>

      <p>Please wait...</p>
    </div>
  </div>

  <!-- Older IE warning message -->
  <!--[if lt IE 9]>
  <div class="ie-warning">
  <h1 class="c-white">Warning!!</h1>
  <p>You are using an outdated version of Internet Explorer, please upgrade <br/>to any of the following web browsers to access this website.</p>
  <div class="iew-container">
  <ul class="iew-download">
  <li>
  <a href="http://www.google.com/chrome/">
  <img src="img/browsers/chrome.png" alt="">
  <div>Chrome</div>
</a>
</li>
<li>
<a href="https://www.mozilla.org/en-US/firefox/new/">
<img src="img/browsers/firefox.png" alt="">
<div>Firefox</div>
</a>
</li>
<li>
<a href="http://www.opera.com">
<img src="img/browsers/opera.png" alt="">
<div>Opera</div>
</a>
</li>
<li>
<a href="https://www.apple.com/safari/">
<img src="img/browsers/safari.png" alt="">
<div>Safari</div>
</a>
</li>
<li>
<a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">
<img src="img/browsers/ie.png" alt="">
<div>IE (New)</div>
</a>
</li>
</ul>
</div>
<p>Sorry for the inconvenience!</p>
</div>
<![endif]-->


<!-- Javascript Libraries -->
<script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
<script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<script src="vendors/bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="vendors/bower_components/Waves/dist/waves.min.js"></script>
<script src="vendors/bootstrap-growl/bootstrap-growl.min.js"></script>
<script src="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.min.js"></script>
<script src="vendors/bootgrid/jquery.bootgrid.updated.min.js"></script>
<!-- Script Agregado por Luis Bello-->
<script src="vendors/bower_components/moment/min/moment.min.js"></script>
<script src="vendors/bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>
<script src="vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
<script src="http://server-bamboodb.rhcloud.com/libs/bamboo.js"></script>
<script src="vendors/bootgrid/jquery.bootgrid.updated.min.js"></script>
<script src="vendors/bower_components/nouislider/distribute/jquery.nouislider.all.min.js"></script>
<script src="vendors/bower_components/typeahead.js/dist/typeahead.bundle.min.js"></script>
<script src="vendors/summernote/dist/summernote-updated.min.js"></script>

<!-- Placeholder for IE9 -->
<!--[if IE 9 ]>
<script src="vendors/bower_components/jquery-placeholder/jquery.placeholder.min.js"></script>
<![endif]-->
<script src="js/caribedev.js"></script>
<script src="js/functions.js"></script>

<script type="text/javascript">

var x_relationshipt = ['Father', 'Mother', 'Son', 'Daughter', 'Brother', 'Sister', 'Grandson', 'Granddaughter', 'Grandfather', 'Grandmother', 'Nephew', 'Niece', 'Uncle', 'Aunt', 'Friend', 'Wife', 'Husband'];
var x_reason = ["Help", "Maintenance", "Services pay"];

function getParam(key) {
  // Find the key and everything up to the ampersand delimiter
  var value = RegExp("" + key + "[^&]+").exec(window.location.search);

  // Return the unescaped value minus everything starting from the equals sign or an empty string
  return unescape(!!value ? value.toString().replace(/^[^=]+./, "") : "");
}

$(document).ready(
  function () {
    caribedev_view_customer(getParam('uuid_customer'));
    caribedev_view_transaction_profile(getParam('uuid_customer'));

    // caribedev_view_customer('');
    // caribedev_view_transaction_profile('');

    function getParam(key) {
      // Find the key and everything up to the ampersand delimiter
      var value = RegExp("" + key + "[^&]+").exec(window.location.search);

      // Return the unescaped value minus everything starting from the equals sign or an empty string
      return unescape(!!value ? value.toString().replace(/^[^=]+./, "") : "");
    }

  }
);

function caribedev_view_customer(uuid_customer) {
  $method = 'GET';
  $url = caribedevelopers_server + "/customer/" + uuid_customer;
  $.getJSON($url, function (data) {

    if (data.code == 'OK') {
      caribedev_view_customer_ok(data);
    }
    else {
      caribedev_view_customer_error(data);
    }

  });
}

function caribedev_view_customer_ok(data) {
  if (data.customer.length > 0) {
    $('#transaction_profile_uuid').val(data.customer[0].customer_uuid);
    $('#transaction_profile_idcard').val(data.customer[0].customer_id_card);
    $('#transaction_profile_name').val(data.customer[0].customer_first_name);
    $('#transaction_profile_lastname').val(data.customer[0].customer_last_name);
  }
}
function caribedev_view_customer_error(data) {
  console.log(data);
  alert('Sorry, here was an error listing the item');
}

function caribedev_view_transaction_profile(uuid_customer) {
  $method = 'GET';
  $url = caribedevelopers_server + "/transaction_profile";
  $.getJSON($url, function (data) {

    if (data.code == 'OK') {
      caribedev_view_transaction_profile_ok(data);
    }
    else {
      caribedev_view_transaction_profile_error(data);
    }

  });
}

function caribedev_view_transaction_profile_ok(data) {
  $('#tbl_profile_send').bootgrid('clear');
  $('#tbl_profile_receive').bootgrid('clear');

  $.each(data.transaction_profile, function (i, item) {

    var shide_info = '';
    shide_info += '<input type="hidden" id="customer_id" name="customer_id" value="' + item.transaction_profile_id + '" />';

    if (item.transaction_profile_type) {
      var grid = $("#tbl_profile_send").bootgrid('append',
      [{
        transaction_profile_name: "<a href='transaction_profile_edit.aspx?type=" + 0 + "transaction_profile_uuid=" + item.transaction_profile_uuid + "'>" + item.transaction_profile_full_name_ce + "</a>",
        transaction_profile_country: item.transaction_profile_country_ce,
        transaction_profile_relationship: x_relationshipt[item.transaction_profile_relationship_to_ce],
        transaction_profile_reason: x_reason[item.transaction_profile_reason_ce],
        commands: "<button type=\"button\" data-row-id=\"" + item.transaction_profile_uuid + "\" id=\"edit_survey\" name=\"edit_survey\"  class=\"btn btn-icon command-edit waves-effect waves-circle\"" + "\"><span class=\"zmdi zmdi-edit\"></span></button> " +
        "<button type=\"button\" data-row-id=\"" + item.transaction_profile_uuid + "\" id=\"delete_survey\" name=\"delete_survey\" class=\"btn btn-icon command-delete waves-effect waves-circle\"\"><span class=\"zmdi zmdi-delete\"></span></button>"
      }]
    ).on("loaded.rs.jquery.bootgrid", function () {
      /* Action to delete */
      grid.find(".command-delete").on("click", function (e) {
        var domElement = $(e.currentTarget);
        swal({
          title: "Are you sure?",
          text: "You will not be able to recover this imaginary file!",
          type: "warning",
          showCancelButton: true,
          confirmButtonColor: "#DD6B55",
          confirmButtonText: "Yes, delete it!",
          closeOnConfirm: false
        }, function () {
          $method = 'DELETE';
          $token = '';
          $url = caribedevelopers_server + "/transaction_porfile/" + domElement.attr('data-row-id');
          $.ajax({
            type: $method,
            url: $url,
            contentType: 'application/x-www-form-urlencoded'
            //,
            //headers: {
            //    "token": $token
            //}
          }).done(function (data) {
          

            if (data.code != 'OK') //DO IF RESPONSE ERROR
            {
              swal("The transaction profile could not be deleted!", "Please, try again later.", "error");

            } else //DO IF RESPONSE OK
            {
              swal({
                title: "Transaction profile deleted!",
                type: "success",
                showCancelButton: false,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Close",
                closeOnConfirm: false
              }, function () {
                location.reload();
              });
            }
          });

        });
      });
      /* Action to update */
      grid.find(".command-edit").on("click", function (e) {
        var domElement = $(e.currentTarget);
        window.location.href = 'transaction_profile_edit.aspx?type=' + 0 + 'transaction_profile_uuid=' + domElement.attr('data-row-id');
      });
    });
  }
  else {
    var grid = $("#tbl_profile_receive").bootgrid('append',
    [{
      transaction_profile_name: "<a href='transaction_profile_edit.aspx?type=" + 1 + "transaction_profile_uuid=" + item.transaction_profile_uuid + "'>" + item.transaction_profile_full_name_ce + "</a>",
      transaction_profile_country: item.transaction_profile_country_ce,
      transaction_profile_relationship: x_relationshipt[item.transaction_profile_relationship_to_ce],
      transaction_profile_reason: x_reason[item.transaction_profile_reason_ce],
      commands: "<button type=\"button\" data-row-id=\"" + item.transaction_profile_uuid + "\" id=\"edit_survey\" name=\"edit_survey\"  class=\"btn btn-icon command-edit waves-effect waves-circle\"" + "\"><span class=\"zmdi zmdi-edit\"></span></button> " +
      "<button type=\"button\" data-row-id=\"" + item.transaction_profile_uuid + "\" id=\"delete_survey\" name=\"delete_survey\" class=\"btn btn-icon command-delete waves-effect waves-circle\"\"><span class=\"zmdi zmdi-delete\"></span></button>"
    }]
  ).on("loaded.rs.jquery.bootgrid", function () {
    /* Action to delete */
    grid.find(".command-delete").on("click", function (e) {
      var domElement = $(e.currentTarget);
      swal({
        title: "Are you sure?",
        text: "You will not be able to recover this imaginary file!",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "Yes, delete it!",
        closeOnConfirm: false
      }, function () {
        $method = 'DELETE';
        $token = '';
        $url = caribedevelopers_server + "/transaction_profile/" + domElement.attr('data-row-id');
        $.ajax({
          type: $method,
          url: $url,
          contentType: 'application/x-www-form-urlencoded'
          //,
          //headers: {
          //    "token": $token
          //}
        }).done(function (data) {


          if (data.code != 'OK') //DO IF RESPONSE ERROR
          {
            swal("The transaction profile could not be deleted!", "Please, try again later.", "error");

          } else //DO IF RESPONSE OK
          {
            swal({
              title: "Transaction profile deleted!",
              type: "success",
              showCancelButton: false,
              confirmButtonColor: "#DD6B55",
              confirmButtonText: "Close",
              closeOnConfirm: false
            }, function () {
              location.reload();
            });
          }
        });

      });
    });
    /* Action to update */
    grid.find(".command-edit").on("click", function (e) {
      var domElement = $(e.currentTarget);
      window.location.href = 'transaction_profile_edit.aspx?type=' + 1 + 'transaction_profile_uuid=' + domElement.attr('data-row-id');
    });
  });
}

});

}

$('#btn_transaction_profile_create').click(
  function (e) {
    window.location.href = 'transaction_profile_create.aspx?customer_uuid=' + getParam('customer_uuid');
  }
);

function caribedev_view_transaction_profile_error(data) {
  console.log(data);
  alert('Sorry, here was an error listing the item');
}
</script>
</body>
</html>
